{% extends 'news/auth_base.html' %}
{% load socialaccount %}

{% block title %}Sign up - Burst{% endblock %}

{% block auth_nav %}
<a href="{% url 'news:login' %}">Sign in</a>
{% endblock %}

{% block auth_content %}
<svg class="auth-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
    <circle cx="9" cy="7" r="4"/>
    <line x1="19" y1="8" x2="19" y2="14"/>
    <line x1="22" y1="11" x2="16" y2="11"/>
</svg>
<h1 class="auth-title">Sign up</h1>

<ul class="auth-benefits">
    <li>Read articles from publishers</li>
    <li>Subscribe to journalists</li>
    <li>Get notifications when new articles publish</li>
</ul>

<p class="auth-disclaimer">When you sign up, our <a href="{% url 'news:terms' %}">Terms</a> and <a href="{% url 'news:privacy' %}">Privacy Policy</a> will apply.</p>

<form method="post" id="register-form" class="auth-form">
    {% csrf_token %}
    {% if form.non_field_errors %}
        <div class="message error">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="form-group">
        <label for="id_username" class="form-label">Username</label>
        {{ form.username }}
        {% if form.username.errors %}<span class="error">{{ form.username.errors.0 }}</span>{% endif %}
    </div>
    <div class="form-group">
        <label for="id_email" class="form-label">Email Address</label>
        {{ form.email }}
        {% if form.email.errors %}<span class="error">{{ form.email.errors.0 }}</span>{% endif %}
    </div>
    <div class="form-group">
        <label for="id_first_name" class="form-label">First name</label>
        {{ form.first_name }}
        {% if form.first_name.errors %}<span class="error">{{ form.first_name.errors.0 }}</span>{% endif %}
    </div>
    <div class="form-group">
        <label for="id_last_name" class="form-label">Last name</label>
        {{ form.last_name }}
        {% if form.last_name.errors %}<span class="error">{{ form.last_name.errors.0 }}</span>{% endif %}
    </div>
    <div class="form-group">
        <label for="id_role" class="form-label">I want to</label>
        {{ form.role }}
        <small class="form-hint">Choose how you'll use the app.</small>
        {% if form.role.errors %}<span class="error">{{ form.role.errors.0 }}</span>{% endif %}
    </div>

    <section class="publisher-select-group form-section" id="publisher-select-group">
        <div class="form-group">
            <label for="id_publisher" class="form-label">Select publisher</label>
            {{ form.publisher }}
            {% if form.publisher.errors %}<span class="error">{{ form.publisher.errors.0 }}</span>{% endif %}
        </div>
    </section>

    <section class="publisher-create-group form-section" id="publisher-create-group">
        <div class="form-group">
            <label for="id_publisher_name" class="form-label">Publication name</label>
            {{ form.publisher_name }}
            {% if form.publisher_name.errors %}<span class="error">{{ form.publisher_name.errors.0 }}</span>{% endif %}
        </div>
        <div class="form-group">
            <label for="id_publisher_description" class="form-label">Description (optional)</label>
            {{ form.publisher_description }}
        </div>
        <div class="form-group">
            <label for="id_publisher_website" class="form-label">Website (optional)</label>
            {{ form.publisher_website }}
        </div>
    </section>

    <div class="form-group password-toggle-wrap">
        <label for="id_password1" class="form-label">Password</label>
        {{ form.password1 }}
        <button type="button" class="password-toggle-btn" aria-label="Show password" data-target="id_password1">SHOW</button>
        {% if form.password1.errors %}<span class="error">{{ form.password1.errors.0 }}</span>{% endif %}
    </div>
    <div class="form-group password-toggle-wrap">
        <label for="id_password2" class="form-label">Confirm password</label>
        {{ form.password2 }}
        <button type="button" class="password-toggle-btn" aria-label="Show password" data-target="id_password2">SHOW</button>
        {% if form.password2.errors %}<span class="error">{{ form.password2.errors.0 }}</span>{% endif %}
    </div>

    <button type="submit" class="btn btn-primary">OK, sign up using email</button>
</form>

{% get_providers as socialaccount_providers %}
{% if socialaccount_providers %}
<div class="auth-divider">Or sign up with</div>
<div class="auth-social">
    {% for provider in socialaccount_providers %}
    <a href="{% provider_login_url provider.id next='/' %}" class="auth-social-btn {{ provider.id }}" title="Sign up with {{ provider.name }}" aria-label="Sign up with {{ provider.name }}">
        {% if provider.id == 'apple' %}
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/></svg>
        {% else %}
        {{ provider.name|slice:":1" }}
        {% endif %}
    </a>
    {% endfor %}
</div>
{% endif %}

<p class="auth-existing">Already have a profile? <a href="{% url 'news:login' %}">Sign in</a></p>

<script>
(function() {
    function togglePublisherFields() {
        var role = document.getElementById('id_role');
        if (!role) return;
        var roleVal = role.value;
        var selectGroup = document.getElementById('publisher-select-group');
        var createGroup = document.getElementById('publisher-create-group');
        if (roleVal === 'editor' || roleVal === 'journalist') {
            selectGroup.style.display = 'block';
            createGroup.style.display = 'none';
        } else if (roleVal === 'publisher') {
            selectGroup.style.display = 'none';
            createGroup.style.display = 'block';
        } else {
            selectGroup.style.display = 'none';
            createGroup.style.display = 'none';
        }
    }
    var roleSelect = document.getElementById('id_role');
    if (roleSelect) {
        roleSelect.addEventListener('change', togglePublisherFields);
        togglePublisherFields();
    }

    document.querySelectorAll('.password-toggle-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var target = document.getElementById(this.getAttribute('data-target'));
            if (!target) return;
            if (target.type === 'password') {
                target.type = 'text';
                this.textContent = 'HIDE';
            } else {
                target.type = 'password';
                this.textContent = 'SHOW';
            }
        });
    });
})();
</script>
{% endblock %}
