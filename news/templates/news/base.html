{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Burst{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Read and publish news. Subscribe to publishers and journalists.{% endblock %}">
    <meta name="author" content="Burst">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0d9488">
    <link rel="alternate" type="application/rss+xml" title="Burst - Latest News" href="{% url 'news:article_feed' %}">

    {% block meta_extra %}{% endblock %}

    <!-- Open Graph -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Burst{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Read and publish news. Subscribe to publishers and journalists.{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:site_name" content="{{ SITE_NAME }}">
    {% block og_image %}{% endblock %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="{% block twitter_card %}summary{% endblock %}">
    <meta name="twitter:title" content="{% block twitter_title %}Burst{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Read and publish news. Subscribe to publishers and journalists.{% endblock %}">
    {% block twitter_image %}{% endblock %}

    <link rel="icon" href="{% static 'news/favicon.svg' %}" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'news/css/main.css' %}">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header class="header">
        <nav class="nav">
            <div class="nav-primary">
                <a href="{% url 'news:home' %}" class="nav-brand">Burst</a>
                <a href="{% url 'news:home' %}">Home</a>
                <a href="{% url 'news:article_list' %}">Articles</a>
                <a href="{% url 'news:newsletter_list' %}">Newsletters</a>
                {% if user.is_authenticated %}
                    {% if user.is_journalist %}
                        <a href="{% url 'news:create_article' %}">Create Article</a>
                        <a href="{% url 'news:create_newsletter' %}">Create Newsletter</a>
                    {% endif %}
                    {% if user.is_editor %}
                        <a href="{% url 'news:article_list' %}" class="nav-link-highlight">Review Articles</a>
                    {% endif %}
                    {% if user.is_reader %}
                        <a href="{% url 'news:subscription_management' %}">My Subscriptions</a>
                    {% endif %}
                    {% if user.is_staff %}
                        <a href="{% url 'news:publisher_list' %}">Manage Publishers</a>
                    {% endif %}
                    {% if user.is_publisher %}
                        <a href="{% url 'news:publisher_dashboard' %}" class="nav-link-highlight">Publisher Dashboard</a>
                    {% endif %}
                {% endif %}
            </div>
            <div class="nav-secondary">
                <form method="get" action="{% url 'news:search_articles' %}" class="nav-search-form" role="search">
                    <input type="text" name="q" id="search-input" class="nav-search-input" placeholder="Searchâ€¦" aria-label="Search articles" autocomplete="off">
                </form>
                {% if user.is_authenticated %}
                    <span class="news-brand">Welcome, {{ user.username }}</span>
                    <a href="{% url 'news:logout' %}">Logout</a>
                {% else %}
                    <a href="{% url 'news:login' %}">Sign in</a>
                    <a href="{% url 'news:register' %}" class="nav-link-highlight">Create account</a>
                {% endif %}
            </div>
        </nav>
        {% block category_bar %}
        {% if categories %}
        <div class="tag-bar-wrap">
            <button type="button" class="tag-bar-scroll tag-bar-scroll-left" aria-label="Scroll categories left" data-target="category-bar">&#8592;</button>
            <div class="tag-bar" id="category-bar">
                <a href="{% url 'news:home' %}{% if request.GET.publisher %}?publisher={{ request.GET.publisher|urlencode }}{% endif %}" class="tag-pill {% if not request.GET.category %}active{% endif %}">All News</a>
                {% for category in categories %}
                <a href="{% url 'news:home' %}?category={{ category.name|urlencode }}{% if request.GET.publisher %}&publisher={{ request.GET.publisher|urlencode }}{% endif %}" class="tag-pill {% if request.GET.category == category.name %}active{% endif %}">{{ category.name }}</a>
                {% endfor %}
            </div>
            <button type="button" class="tag-bar-scroll tag-bar-scroll-right" aria-label="Scroll categories right" data-target="category-bar">&#8594;</button>
        </div>
        {% endif %}
        {% if publishers %}
        <div class="tag-bar-wrap tag-bar-wrap-publishers">
            <button type="button" class="tag-bar-scroll tag-bar-scroll-left" aria-label="Scroll publishers left" data-target="publisher-bar">&#8592;</button>
            <div class="tag-bar" id="publisher-bar">
                <a href="{% url 'news:home' %}{% if request.GET.category %}?category={{ request.GET.category|urlencode }}{% endif %}" class="tag-pill tag-pill-publisher {% if not request.GET.publisher %}active{% endif %}">All Publishers</a>
                {% for publisher in publishers %}
                <a href="{% url 'news:home' %}?publisher={{ publisher.name|urlencode }}{% if request.GET.category %}&category={{ request.GET.category|urlencode }}{% endif %}" class="tag-pill tag-pill-publisher {% if request.GET.publisher == publisher.name %}active{% endif %}">{{ publisher.name }}</a>
                {% endfor %}
            </div>
            <button type="button" class="tag-bar-scroll tag-bar-scroll-right" aria-label="Scroll publishers right" data-target="publisher-bar">&#8594;</button>
        </div>
        {% endif %}
        {% endblock %}
    </header>

    <main id="main-content" class="container">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>
    <footer class="site-footer">
        <div class="footer-content">
            <span>Need help?</span>
            <a href="mailto:support@burst.app">support@burst.app</a>
        </div>
    </footer>
    <script>
    (function() {
        document.addEventListener('keydown', function(e) {
            if (e.key !== '/' || e.ctrlKey || e.metaKey || e.altKey) return;
            var active = document.activeElement;
            if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable)) return;
            e.preventDefault();
            var el = document.getElementById('search-input');
            if (el) { el.focus(); el.select(); }
        });
    })();
    </script>
    {% if categories or publishers %}
    <script>
    (function() {
        document.querySelectorAll('.tag-bar-scroll').forEach(function(btn) {
            var targetId = btn.getAttribute('data-target');
            var bar = targetId ? document.getElementById(targetId) : null;
            var isLeft = btn.classList.contains('tag-bar-scroll-left');
            if (bar) btn.addEventListener('click', function() { bar.scrollBy({ left: isLeft ? -200 : 200, behavior: 'smooth' }); });
        });
    })();
    </script>
    {% endif %}
</body>
</html>
